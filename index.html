<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FILHÃO.CELL (v43)</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#d50000">

    <link rel="stylesheet" href="style.css">
</head>
<body>

<div id="loading" style="position:fixed;top:0;left:0;width:100%;height:100%;background:#d50000;z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;color:white;font-weight:bold;">
    <div>FILHAO.CELL</div>
</div>

<div id="area-print"></div>

<div id="modal-overlay" onclick="fecharModal(event)">
    <div class="modal-content">
        <h3 style="justify-content:center">AÇÕES</h3>
        <button class="btn" style="background:#25d366; margin-top:10px" onclick="acaoShare('zap')"><i class="fab fa-whatsapp"></i> WHATSAPP</button>
        <button class="btn" style="background:#333; margin-top:10px" onclick="acaoShare('print')"><i class="fas fa-print"></i> TÉRMICA 80MM</button>
        <button class="btn" style="background:#d32f2f; margin-top:10px" onclick="acaoShare('pdf')"><i class="fas fa-file-pdf"></i> PDF / A4</button>
    </div>
</div>

<header>
    <h2><i class="fas fa-fire"></i> FILHAO.CELL <div class="version-btn" onclick="forcarAtualizacao()">v43 <i class="fas fa-sync-alt"></i></div></h2>
    <div id="status-conn" style="font-size:10px"><i class="fas fa-wifi"></i></div>
</header>

<div class="container">

    <div id="page-vendas" class="page active">
        <div class="card">
            <h3><i class="fas fa-cash-register"></i> CAIXA</h3>
            
            <label>CLIENTE</label>
            <div class="search-box">
                <input type="text" id="v-cli" placeholder="BUSCAR CLIENTE..." onkeyup="buscar('clientes', this.value, 'sug-v-cli')">
                <button type="button" class="search-btn" onclick="toggleSearch('cli', 'v-cli', 'sug-v-cli')"><i class="fas fa-search"></i></button>
                <div id="sug-v-cli" class="sugestoes"></div>
            </div>
            <button class="btn-novo" style="margin-top:10px" onclick="cadastrarNovoNaVenda()"><i class="fas fa-plus"></i> NOVO CLIENTE</button>

            <label style="margin-top:15px">ADICIONAR ITEM</label>
            <div class="search-box">
                <input type="text" id="v-busca" placeholder="BIPAR OU DIGITAR..." onkeyup="buscarVenda(this.value)">
                <button type="button" class="search-btn" onclick="toggleSearch('venda', 'v-busca', 'sug-v-prod')"><i class="fas fa-search"></i></button>
                <div id="sug-v-prod" class="sugestoes"></div>
            </div>

            <div style="background:#f9f9f9; border:2px dashed #e0e0e0; padding:15px; margin-top:20px; border-radius:12px">
                <div style="font-size:10px; color:#999; text-align:center; margin-bottom:5px">CLIQUE NO LÁPIS PARA ALTERAR O VALOR</div>
                <div id="carrinho-lista" style="font-size:12px; color:#888; text-align:center; padding:10px">CARRINHO VAZIO</div>
                <div style="text-align:right; font-size:18px; font-weight:900; margin-top:15px; color:var(--primary); border-top:1px solid #ddd; padding-top:10px" id="v-total">TOTAL: R$ 0,00</div>
            </div>

            <div style="display:flex; gap:10px">
                <button class="btn btn-dark" style="flex:1" onclick="abrirShare('orcamento')"><i class="fas fa-share-alt"></i></button>
                <button class="btn btn-primary" style="flex:2" onclick="finalizarVenda()">FINALIZAR VENDA</button>
            </div>
        </div>
    </div>

    <div id="page-servicos" class="page">
        <div class="card">
            <h3>NOVA O.S. <button class="btn-novo" onclick="limparOS()"><i class="fas fa-file"></i> NOVA</button></h3>
            <input type="hidden" id="os-id">
            <input type="hidden" id="os-status-orig">
            
            <label>CLIENTE</label>
            <div style="display:flex; gap:5px; align-items:flex-end">
                <div class="search-box" style="flex:1">
                    <input type="text" id="s-cli" placeholder="BUSCAR..." onkeyup="buscar('clientes', this.value, 'sug-s-cli')">
                    <button type="button" class="search-btn" onclick="toggleSearch('cli', 's-cli', 'sug-s-cli')"><i class="fas fa-search"></i></button>
                    <div id="sug-s-cli" class="sugestoes"></div>
                </div>
                <button class="btn-add-mini" onclick="cadastrarNovoNaOS()"><i class="fas fa-plus"></i></button>
            </div>
            
            <div style="display:flex; gap:10px">
                <div style="flex:1"><label>MODELO</label><input id="s-mod"></div>
                <div style="flex:1"><label>SENHA</label><input id="s-senha"></div>
            </div>
            
            <label>DEFEITO / OBS</label>
            <input id="s-def">
            
            <label>FOTOS DO APARELHO (MÁX 4)</label>
            <div class="os-foto-grid">
                <div class="os-foto-slot" onclick="addFotoOS(0)"><i class="fas fa-camera"></i></div>
                <div class="os-foto-slot" onclick="addFotoOS(1)"><i class="fas fa-camera"></i></div>
                <div class="os-foto-slot" onclick="addFotoOS(2)"><i class="fas fa-camera"></i></div>
                <div class="os-foto-slot" onclick="addFotoOS(3)"><i class="fas fa-camera"></i></div>
            </div>
            <input type="file" id="os-foto-input" hidden onchange="processFotoOS(this)">

            <label>ADICIONAR PEÇA/SERVIÇO</label>
            <div class="search-box">
                <input type="text" id="s-busca-item" placeholder="BUSCAR PEÇA..." onkeyup="buscarItemOS(this.value)">
                <button type="button" class="search-btn" onclick="toggleSearch('os', 's-busca-item', 'sug-os-item')"><i class="fas fa-search"></i></button>
                <div id="sug-os-item" class="sugestoes"></div>
            </div>

            <div style="background:#f9f9f9; border:2px dashed #e0e0e0; padding:10px; margin-top:15px; border-radius:12px">
                <div style="font-size:10px; color:#999; text-align:center; margin-bottom:5px">CLIQUE NO LÁPIS PARA ALTERAR O VALOR</div>
                <div id="os-lista-itens"></div>
                <div style="text-align:right; font-size:16px; font-weight:900; margin-top:10px; color:var(--primary); padding-top:5px; border-top:1px solid #ddd" id="s-total-display">TOTAL: R$ 0,00</div>
            </div>

            <button class="btn btn-primary" onclick="salvarOS()">SALVAR ORDEM</button>
        </div>

        <div class="kanban-grid">
            <div class="k-col">
                <div class="k-head" style="color:#555">ANÁLISE</div>
                <div id="k-pecas"></div>
            </div>
            <div class="k-col">
                <div class="k-head" style="color:#ff9800; font-size:8px">AGUARDANDO PAGAMENTO</div>
                <div id="k-pgto"></div>
            </div>
            <div class="k-col">
                <div class="k-head" style="color:green">PRONTO</div>
                <div id="k-retirado"></div>
            </div>
        </div>
    </div>

    <div id="page-clientes" class="page">
        <div class="card" id="form-cli">
            <h3>CLIENTES <button class="btn-novo" onclick="limparCli()"><i class="fas fa-user-plus"></i> NOVO</button></h3>
            <input type="hidden" id="c-id">
            
            <img id="c-foto-view" src="" class="foto-preview" onclick="document.getElementById('c-foto').click()">
            <input type="file" id="c-foto" hidden onchange="lerFoto(this, 'c-foto-view')">

            <input type="text" id="c-nome" placeholder="NOME COMPLETO *">
            <input type="tel" id="c-tel" placeholder="WHATSAPP" oninput="maskTel(this)">
            <div style="display:flex; gap:10px">
                <input type="text" id="c-bairro" placeholder="BAIRRO">
                <input type="text" id="c-cidade" placeholder="CIDADE">
            </div>
            
            <button class="btn btn-primary" onclick="salvarCliente()">SALVAR CLIENTE</button>
        </div>
        <div class="card">
            <h3>MEUS CLIENTES</h3>
            <div class="search-box">
                <input type="text" id="cli-search-input" placeholder="FILTRAR LISTA..." onkeyup="buscar('clientes', this.value, 'lista-clientes', true)">
                <button type="button" class="search-btn" onclick="toggleSearch('listacli', 'cli-search-input', 'lista-clientes')"><i class="fas fa-search"></i></button>
            </div>
            <div id="lista-clientes" style="margin-top:15px"></div>
        </div>
    </div>

    <div id="page-estoque" class="page">
        <div class="card">
            <h3>ITEM DE ESTOQUE <button class="btn-novo" onclick="limparEstoque()"><i class="fas fa-plus"></i> NOVO</button></h3>
            <input type="hidden" id="p-id">
            
            <img id="p-foto-view" src="" class="foto-preview" onclick="document.getElementById('p-foto').click()">
            <input type="file" id="p-foto" hidden onchange="lerFoto(this, 'p-foto-view')">

            <input type="text" id="p-nome" placeholder="DESCRIÇÃO *">
            <div style="display:flex; gap:10px">
                <input type="number" id="p-venda" placeholder="R$ VENDA *">
                <input type="number" id="p-qtd" placeholder="QTD">
            </div>
            
            <div style="margin-top:10px; border-top:1px dashed #ccc; padding-top:10px">
                <label style="margin-top:0; color:#c62828"><i class="fas fa-lock"></i> PREÇO DE CUSTO</label>
                <div style="display:flex; gap:5px">
                    <input type="number" id="p-custo" placeholder="0.00" style="border-color:#ffcdd2">
                    <button id="btn-ver-custo" class="btn-dark" style="width:50px; border-radius:10px; display:none" onclick="revelarCusto()"><i class="fas fa-eye"></i></button>
                </div>
            </div>

            <div style="display:flex; gap:10px; margin-top:10px">
                <button class="btn btn-primary" onclick="salvarProduto('prod')">SALVAR PRODUTO</button>
                <button class="btn btn-dark" onclick="salvarProduto('serv')">SALVAR SERVIÇO</button>
            </div>
        </div>
        
        <div class="card">
            <div style="display:flex; gap:5px; margin-bottom:10px">
                <button class="btn-mini btn-dark" onclick="listarEstoque('prod')">PRODUTOS</button>
                <button class="btn-mini btn-dark" style="opacity:0.7" onclick="listarEstoque('serv')">SERVIÇOS</button>
            </div>
            <div id="lista-estoque"></div>
        </div>
    </div>

    <div id="page-relatorio" class="page">
        <div class="card">
            <h3>RELATÓRIOS FINANCEIROS</h3>
            <select id="r-filtro" onchange="renderRelatorio()" style="margin-bottom:15px">
                <option value="dia">HOJE</option>
                <option value="semana">ÚLTIMOS 7 DIAS</option>
                <option value="mes">MÊS ATUAL</option>
                <option value="ano">ESTE ANO</option>
            </select>
            
            <div style="background:var(--accent); color:white; padding:20px; border-radius:12px; text-align:center">
                <div style="font-size:11px; opacity:0.8">FATURAMENTO TOTAL</div>
                <div id="r-total" style="font-size:24px; font-weight:900; margin-top:5px">R$ 0,00</div>
            </div>

            <h3 style="margin-top:25px; font-size:12px; color:#666">HISTÓRICO DETALHADO</h3>
            
            <div class="search-box" style="margin-bottom:10px">
                <input type="text" id="r-search" placeholder="BUSCAR NO HISTÓRICO..." onkeyup="buscar('clientes', this.value, 'sug-r-cli'); renderRelatorio()">
                <button class="search-btn" onclick="toggleSearch('cli', 'r-search', 'sug-r-cli')"><i class="fas fa-search"></i></button>
                <div id="sug-r-cli" class="sugestoes"></div>
            </div>

            <div id="r-hist" style="max-height:250px; overflow-y:auto; border:1px solid #eee; border-radius:8px; padding:5px"></div>

            <h3 style="margin-top:20px; font-size:12px; color:#666">RANKINGS DE DESEMPENHO</h3>
            <div class="rank-grid">
                <div class="rank-box">
                    <div class="rank-title">CLIENTES</div>
                    <div id="rank-cli"></div>
                </div>
                <div class="rank-box">
                    <div class="rank-title">PRODUTOS</div>
                    <div id="rank-prod"></div>
                </div>
                <div class="rank-box">
                    <div class="rank-title">SERVIÇOS</div>
                    <div id="rank-serv"></div>
                </div>
            </div>
        </div>
    </div>

</div>

<nav>
    <button class="nav-item active" onclick="nav('vendas', this)"><i class="fas fa-shopping-cart"></i>VENDAS</button>
    <button class="nav-item" onclick="nav('servicos', this)"><i class="fas fa-wrench"></i>OS</button>
    <button class="nav-item" onclick="nav('clientes', this)"><i class="fas fa-users"></i>CLIENTES</button>
    <button class="nav-item" onclick="nav('estoque', this)"><i class="fas fa-box"></i>ESTOQUE</button>
    <button class="nav-item" onclick="nav('relatorio', this)"><i class="fas fa-chart-line"></i>RELATÓRIOS</button>
</nav>

<script type="module" src="script.js"></script>

</body>
</html>
